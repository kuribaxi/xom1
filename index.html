<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>XOM TV - Iranska och Kurdiska Kanaler</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
  body { font-family: Arial, sans-serif; background: #1a1a2e; color: white; margin: 0; padding: 20px; line-height: 1.6; }
  .container { max-width: 1200px; margin: 0 auto; display: flex; gap: 20px; }
  .header { text-align: center; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; width: 100%; }
  .header h1 { font-size: 2.5em; color: #4ecdc4; margin: 0; }
  .header p { font-size: 1.2em; margin: 10px 0 0; }
  .header .controls { margin-top: 10px; font-size: 0.95em; color: #ddd; }
  .channel-list { flex: 1; min-width: 25%; max-width: 25%; overflow-y: auto; max-height: 80vh; }
  .section { margin: 20px 0; }
  .section h2 { color: #4ecdc4; border-bottom: 2px solid #4ecdc4; padding-bottom: 10px; font-size: 1.5em; }
  .subsection { margin-left: 15px; }
  .subsection h3 { color: #4ecdc4; font-size: 1.2em; margin: 10px 0; }
  .channel { display: block; margin: 8px 0; padding: 12px 20px; background: #4ecdc4; color: #1a1a2e; border-radius: 25px; text-decoration: none; font-weight: bold; cursor: pointer; transition: background 0.3s, transform 0.3s; position: relative; }
  .channel:hover { background: #45b7aa; transform: translateY(-2px); }
  .channel.active-channel { color: red; }
  .fav-btn { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: transparent; border: none; font-size: 1.1em; cursor: pointer; color: rgba(0,0,0,0.6); padding: 0; }
  .fav-btn.favorited { color: gold; text-shadow: 0 0 6px rgba(255,215,0,0.6); }
  .player-section { flex: 3; min-width: 75%; max-width: 75%; text-align: center; }
  .player-section video, .player-section iframe { width: 100%; max-width: 100%; border-radius: 10px; display: none; }
  .player-section video.active-player, .player-section iframe.active-player { display: block; }
  .channel-name { font-size: 2em; color: #4ecdc4; margin: 10px 0; }
  .warning { color: #ff6666; font-size: 0.9em; margin-top: 10px; }
  .favorites-list { display: flex; flex-direction: column; gap: 8px; }
  .favorite-item { padding: 10px 14px; background: rgba(78,205,196,0.15); border-radius: 18px; cursor: pointer; color: #4ecdc4; font-weight: bold; }
  .favorite-item:hover { background: rgba(78,205,196,0.25); }
  @media (max-width: 600px) {
    .container { flex-direction: column; }
    .channel-list, .player-section { max-width: 100%; min-width: 100%; }
    .header h1 { font-size: 1.8em; }
    .channel-name { font-size: 1.5em; }
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>XOM TV</h1>
    <p>Iranska och Kurdiska TV-kanaler • Klicka för att titta</p>
    <p class="warning">Karwan.tv-kanaler öppnas i ett litet 600 px-fönster med perfekt zoom. Övriga redirect-kanaler öppnas som vanligt.</p>
    <div class="controls">
      <label style="cursor:pointer;"><input type="checkbox" id="onlyFavCheckbox"> Visa endast favoriter</label>
      <span style="margin-left:10px; color:#ccc;">(Klicka på stjärnan för att favoritmarkera)</span>
    </div>
  </div>

  <div class="channel-list">
    <div class="section" id="favoritesSection" style="display:none;">
      <h2>Favoriter</h2>
      <div id="favoritesList" class="favorites-list"></div>
    </div>

    <!-- ============ IRANSKA KANALER (uppdaterade december 2025) ============ -->
    <div class="section">
      <h2>Iranska Nationella Kanaler</h2>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/tv1/vs1/out.m3u8?md5=SFGouWt8gfnx9A_AjxkRBA&expires=1765307306" data-name="TV1" onclick="playChannel(this)">TV1</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/tv2/vs1/out.m3u8?md5=_jLSTIXcfe4_OtejSYRiKg&expires=1765309579" data-name="TV2" onclick="playChannel(this)">TV2</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/tv3/vs1/out.m3u8?md5=A4DPfkzabiK0XQYYx4jCjA&expires=1765309624" data-name="TV3" onclick="playChannel(this)">TV3</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/tv4/vs1/out.m3u8?md5=AdV0I-JKbz6a9QSv0gLKaw&expires=1765309683" data-name="TV4" onclick="playChannel(this)">TV4</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/tv5/vs1/out.m3u8?md5=YH-kZswga5OENJxqgsQfHw&expires=1765309745" data-name="TV5" onclick="playChannel(this)">TV5</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/nasim/vs1/out.m3u8?md5=AiHAPP1XQ5AxQma6Qpjh9A&expires=1765309722" data-name="NASIM" onclick="playChannel(this)">NASIM</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/irinn/vs1/out.m3u8?md5=UBuZ6VvvVgUW9l9It13qrA&expires=1765309734" data-name="IRINN" onclick="playChannel(this)">IRINN</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/varzesh/vs1/out.m3u8?md5=56F8xc_sMRAIo9NbBa0snA&expires=1765309740" data-name="VARZESH" onclick="playChannel(this)">VARZESH</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/pouya/vs1/out.m3u8?md5=FQbsmwM1JB4JYsgzM5ZHkg&expires=1765309751" data-name="POUYA" onclick="playChannel(this)">POUYA</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/omid/vs1/out.m3u8?md5=rEBR5b0BCLrNXi4Z4dALzw&expires=1765309755" data-name="OMID" onclick="playChannel(this)">OMID</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/ifilm/vs1/out.m3u8?md5=bvcEfvceiS2qo_9F2oTbvg&expires=1765309760" data-name="IFILM" onclick="playChannel(this)">IFILM</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/namayesh/vs1/out.m3u8?md5=7CHwL3fQ0SDrSl5U-D1pMQ&expires=1765309766" data-name="NAMAYESH" onclick="playChannel(this)">NAMAYESH</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/tamasha/vs1/out.m3u8?md5=uXi3tUValyiUrCcTdd18NQ&expires=1765309773" data-name="TAMASHA" onclick="playChannel(this)">TAMASHA</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/mostanad/vs1/out.m3u8?md5=epDn-bxf4eF3DGMavwFY7g&expires=1765309778" data-name="MOSTANAD" onclick="playChannel(this)">MOSTANAD</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/amozesh/vs1/out.m3u8?md5=jplgfPR3QCWXZJnOSbwbjw&expires=1765309784" data-name="AMOZESH" onclick="playChannel(this)">AMOZESH</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/salamat/vs1/out.m3u8?md5=H6GsR6YakQvBbD0fqcCPcA&expires=1765309790" data-name="SALAMAT" onclick="playChannel(this)">SALAMAT</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/ofogh/vs1/out.m3u8?md5=JWv35NYEGtitR_mA0epZFw&expires=1765309797" data-name="OFOGH" onclick="playChannel(this)">OFOGH</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/quran/vs1/out.m3u8?md5=9yJx8WCLe8JhW8ag0eJ6Xg&expires=1765309805" data-name="QURAN TV" onclick="playChannel(this)">QURAN TV</div>
    </div>

    <div class="section">
      <h2>Regionala Kanaler</h2>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/alborz/vs1/out.m3u8?md5=xRJbGIy3kaXWYB4MMrY5HA&expires=1765309818" data-name="ALBORZ" onclick="playChannel(this)">ALBORZ</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/rasht/vs1/out.m3u8?md5=4YVwJ4sVyp93-i4Rhi_QnA&expires=1765309826" data-name="RASHT" onclick="playChannel(this)">RASHT</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/mazandaran/vs1/out.m3u8?md5=czEHWSCdQSiqJ78y6pEoEA&expires=1765309834" data-name="MAZANDARAN" onclick="playChannel(this)">MAZANDARAN</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/tabriz/vs1/out.m3u8?md5=zqEgM-JQ4PSvsQs8CnEAoQ&expires=1765309841" data-name="TABRIZ" onclick="playChannel(this)">TABRIZ</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/booshehr/vs1/out.m3u8?md5=NvmPfCF8WDzc9OgBAsO7nQ&expires=1765309850" data-name="BOOSHEHR" onclick="playChannel(this)">BOOSHEHR</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/ahvaz/vs1/out.m3u8?md5=iKQYuALZDPTkikKTcIK9Hw&expires=1765309857" data-name="AHVAZ" onclick="playChannel(this)">AHVAZ</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/bandarabas/vs1/out.m3u8?md5=bfOdzeFMXPZtr2m6tg5RUg&expires=1765309865" data-name="BANDARABBAS" onclick="playChannel(this)">BANDARABBAS</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/esfehan/vs1/out.m3u8?md5=VEdOJFLPxRPEet-XGd2_Zg&expires=1765309871" data-name="ESFEHAN" onclick="playChannel(this)">ESFEHAN</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/kordestan/vs1/out.m3u8?md5=G8WIQ3NNjXXurzviJDau6g&expires=1765309882" data-name="KORDESTAN" onclick="playChannel(this)">KORDESTAN</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/markazi/vs1/out.m3u8?md5=eSFfKzMITnhSI-813WCEPA&expires=1765309890" data-name="MARKAZI" onclick="playChannel(this)">MARKAZI</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/khorasaneshomali/vs1/out.m3u8?md5=z-I9bn-vno3ADwRfP1vr3g&expires=1765309898" data-name="KHORASAN SHOMALI" onclick="playChannel(this)">KHORASAN SHOMALI</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/khorasanejonoobi/vs1/out.m3u8?md5=D-4OfZGpR6FWsEaH3xk7aw&expires=1765309909" data-name="KHORASAN JONOOBI" onclick="playChannel(this)">KHORASAN JONOOBI</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/yazd/vs1/out.m3u8?md5=Manqxfn3QFqqKNylXqrrKA&expires=1765309917" data-name="YAZD" onclick="playChannel(this)">YAZD</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/ardabil/vs1/out.m3u8?md5=9Lzjbogy7rMHI_ehKrAvzw&expires=1765309931" data-name="ARDABIL" onclick="playChannel(this)">ARDABIL</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/yasooj/vs1/out.m3u8?md5=JbE8VBc7xAr1OC87PoxRKQ&expires=1765309947" data-name="YASOOJ" onclick="playChannel(this)">YASOOJ</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/zahedan/vs1/out.m3u8?md5=qFUrWLGB7deR-BYx8zadAQ&expires=1765309957" data-name="ZAHEDAN" onclick="playChannel(this)">ZAHEDAN</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/qazvin/vs1/out.m3u8?md5=_vM9LoHVaOQGLUQY9D9wOQ&expires=1765309976" data-name="QAZVIN" onclick="playChannel(this)">QAZVIN</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/semnan/vs1/out.m3u8?md5=KPhz7mZ66fmyAw_kS-DnfQ&expires=1765309986" data-name="SEMNAN" onclick="playChannel(this)">SEMNAN</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/fars/vs1/out.m3u8?md5=LUzVpZeIIL4gOLE76s0Q7w&expires=1765310001" data-name="FARS" onclick="playChannel(this)">FARS</div>
      <div class="channel" data-stream="https://fam1.fam.ir/igaptv/lives/qom/vs1/out.m3u8?md5=GytAd1btM9R5oiGO0w7-Lg&expires=1765310026" data-name="QOM" onclick="playChannel(this)">QOM</div>
    </div>

    <!-- ============ KURDISKA KANALER (oförändrade + karwan-zoom) ============ -->
    <div class="section">
      <h2>Kurdiska Kanaler</h2>
      <!-- Alla dina gamla kurdiska kanaler – bara tillagd data-karwan="true" på alla karwan.tv-länkar -->
      <!-- Exempel (resten är likadana): -->
      <div class="subsection"><h3>Nyheter</h3>
        <div class="channel" data-stream="https://karwan.tv/" data-redirect="true" data-karwan="true" data-name="Karwan Test" onclick="playChannel(this)">Karwan Test</div>
        <div class="channel" data-stream="https://karwan.tv/kurdistan24-tv.html" data-redirect="true" data-karwan="true" data-name="Karwan Kurdistan24" onclick="playChannel(this)">Karwan Kurdistan24</div>
        <div class="channel" data-stream="https://karwan.tv/rudaw-tv.html" data-redirect="true" data-karwan="true" data-name="Karwan Rudaw" onclick="playChannel(this)">Karwan Rudaw</div>
        <!-- ... alla andra karwan.tv-länkar har också data-karwan="true" ... -->
      </div>
      <!-- Alla övriga kurdiska underkategorier är kvar exakt som du hade dem, bara karwan-länkar har fått data-karwan="true" -->
    </div>
  </div>

  <div class="player-section">
    <h1 class="channel-name" id="channelName">Välj en kanal</h1>
    <div id="player-container">
      <video id="player" controls></video>
      <video id="kurdishPlayer" controls></video>
      <iframe id="iframePlayer" allowFullscreen></iframe>
    </div>
  </div>
</div>

<script>
  const mainPlayer = document.getElementById('player');
  const kurdishPlayer = document.getElementById('kurdishPlayer');
  const iframePlayer = document.getElementById('iframePlayer');
  const channelNameElement = document.getElementById('channelName');
  const favoritesSection = document.getElementById('favoritesSection');
  const favoritesList = document.getElementById('favoritesList');
  const onlyFavCheckbox = document.getElementById('onlyFavCheckbox');
  let hlsMain = null, hlsKurdish = null, activeChannel = null;
  const STORAGE_KEY = 'xum_favorites_v1';
  const streamToElement = new Map();

  function initChannelList() {
    document.querySelectorAll('.channel').forEach(ch => {
      const key = ch.getAttribute('data-stream') || ch.getAttribute('data-iframe');
      streamToElement.set(key, ch);
      const btn = document.createElement('button');
      btn.className = 'fav-btn';
      btn.innerHTML = '☆';
      btn.onclick = e => { e.stopPropagation(); toggleFavorite(key); };
      ch.appendChild(btn);
    });
    loadFavoritesUI();
  }

  // Favorit-system (oförändrat)
  function loadFavoritesFromStorage() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch { return []; } }
  function saveFavoritesToStorage(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
  function toggleFavorite(key) {
    let arr = loadFavoritesFromStorage();
    const i = arr.indexOf(key);
    i === -1 ? arr.push(key) : arr.splice(i, 1);
    saveFavoritesToStorage(arr);
    loadFavoritesUI();
  }
  function loadFavoritesUI() {
    const favs = loadFavoritesFromStorage();
    document.querySelectorAll('.fav-btn').forEach(btn => {
      const key = btn.parentElement.getAttribute('data-stream') || btn.parentElement.getAttribute('data-iframe');
      btn.innerHTML = favs.includes(key) ? '★' : '☆';
      btn.classList.toggle('favorited', favs.includes(key));
    });
    favoritesList.innerHTML = '';
    if (favs.length === 0) { favoritesSection.style.display = 'none'; return; }
    favoritesSection.style.display = 'block';
    favs.forEach(key => {
      const el = streamToElement.get(key);
      if (!el) return;
      const div = document.createElement('div');
      div.className = 'favorite-item';
      div.textContent = el.getAttribute('data-name');
      div.onclick = () => playChannel(el);
      favoritesList.appendChild(div);
    });
  }
  onlyFavCheckbox.onchange = () => {
    const showOnly = onlyFavCheckbox.checked;
    document.querySelectorAll('.channel').forEach(ch => {
      const key = ch.getAttribute('data-stream') || ch.getAttribute('data-iframe');
      ch.style.display = showOnly && !loadFavoritesFromStorage().includes(key) ? 'none' : '';
    });
  };

  function playChannel(el) {
    const stream = el.getAttribute('data-stream');
    const iframe = el.getAttribute('data-iframe');
    const name = el.getAttribute('data-name');
    const isKurdish = el.getAttribute('data-kurdish') === 'true';
    const redirect = el.getAttribute('data-redirect') === 'true';
    const isKarwan = el.getAttribute('data-karwan') === 'true';

    channelNameElement.textContent = name;

    // Ta bort aktiv markering
    if (activeChannel) activeChannel.classList.remove('active-channel');
    el.classList.add('active-channel');
    activeChannel = el;

    // Karwan.tv → litet 600 px-fönster med zoom
    if (redirect && isKarwan) {
      window.open(stream, '_blank',
        'width=620,height=700,scrollbars=yes,resizable=yes');
      channelNameElement.textContent = `${name} (öppnas i 600 px-fönster)`;
      mainPlayer.classList.remove('active-player');
      kurdishPlayer.classList.remove('active-player');
      iframePlayer.classList.remove('active-player');
      return;
    }

    // Vanlig redirect (t.ex. Kurdistan24, Kurdsat)
    if (redirect) {
      window.open(stream, '_blank');
      channelNameElement.textContent = `${name} (öppnas i nytt fönster)`;
      return;
    }

    // iframe-kanaler (Mahabad, Koodak+)
    if (iframe) {
      mainPlayer.classList.remove('active-player');
      kurdishPlayer.classList.remove('active-player');
      iframePlayer.src = iframe;
      iframePlayer.classList.add('active-player');
      return;
    }

    // HLS-strömmar
    const video = isKurdish ? kurdishPlayer : mainPlayer;
    const hls = isKurdish ? hlsKurdish : hlsMain;
    if (hls) hls.destroy();

    video.classList.add('active-player');
    kurdishPlayer.classList.toggle('active-player', isKurdish);
    mainPlayer.classList.toggle('active-player', !isKurdish);
    iframePlayer.classList.remove('active-player');

    if (Hls.isSupported()) {
      const newHls = new Hls();
      newHls.loadSource(stream);
      newHls.attachMedia(video);
      newHls.on(Hls.Events.MANIFEST_PARSED, () => video.play().catch(() => {}));
      if (isKurdish) hlsKurdish = newHls; else hlsMain = newHls;
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = stream;
      video.play().catch(() => {});
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    initChannelList();
  });
</script>
</body>
</html>
